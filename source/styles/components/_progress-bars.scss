.with-progress-marker {
  margin:
    ($line-height-computed + $padding-base-vertical * 2 + 2px * 2 + $font-size-base * 1.25)
    ($font-size-base + $border-radius-base + 2px)
    ;

  &,
  .progress-bar {
    overflow: visible;
    position: relative;
  }

  .progress-bar {
    border-top-left-radius: inherit;
    border-bottom-left-radius: inherit;

    &[style*="width:100%"],
    &[style*="width: 100%"] {
      border-top-right-radius: inherit;
      border-bottom-right-radius: inherit;
    }
  }
}

// ===

.progress-marker {
  background-color: #fff;
  border: 2px solid $gray-lighter;
  border-radius: $border-radius-base;
  bottom: 100%;
  color: $brand-primary;
  font-size: $font-size-base;
  line-height: $line-height-base;
  padding: $padding-base-vertical $padding-base-horizontal;
  position: absolute;
  right: 0;
  transform: translateX(50%);

  &:before,
  &:after {
    border-style: solid;
    content: '';
    height: 0;
    position: absolute;
    right: 50%;
    top: 100%;
    transform: translateX(50%);
    width: 0;
  }

  &:before {
    border-width: $font-size-base $font-size-base 0 $font-size-base;
    border-color: $gray-lighter transparent transparent transparent;
  }

  &:after {
    border-width: ($font-size-base - 3px) ($font-size-base - 3px) 0 ($font-size-base - 3px);
    border-color: #fff transparent transparent transparent;
  }
}

.progress-marker-offset {
  margin-bottom: ($font-size-base * 1.25);
  margin-top: ($font-size-base * 1.25);
}

.progress-marker-down {
  bottom: auto;
  top: 100%;

  &:before,
  &:after {
    bottom: 100%;
    top: auto;
  }

  &:before {
    border-width: 0 $font-size-base $font-size-base $font-size-base;
    border-color: transparent transparent $gray-lighter transparent;
  }

  &:after {
    border-width: 0 ($font-size-base - 3px) ($font-size-base - 3px) ($font-size-base - 3px);
    border-color: transparent transparent #fff transparent;
  }
}

.progress-marker-left {
  transform: translateX($font-size-base + $border-radius-base + 2px);

  &:before,
  &:after {
    right: ($font-size-base + $border-radius-base);
  }
}

.progress-marker-right {
  left: 100%;
  right: auto;
  transform: translateX(($font-size-base + $border-radius-base + 2px) * -1);

  &:before,
  &:after {
    left: ($font-size-base + $border-radius-base);
    right: auto;
    transform: translateX(-50%);
  }
}

.progress-marker-jazzy {
  background-color: lighten($red-bright, 30%);
  background-image: linear-gradient(
    to bottom,
    lighten($red-bright, 30%),
    lighten($red-bright, 15%)
    );
  border-color: $brand-primary;
  text-shadow: 0 0 5px #fff;

  &:before {
    border-color: $brand-primary transparent transparent transparent;
  }
  &:after {
    border-color: lighten($red-bright, 30%) transparent transparent transparent;
  }

  &.progress-marker-down:before {
    border-color: transparent transparent $brand-primary transparent;
  }

  &.progress-marker-down:after {
    border-color: transparent transparent lighten($red-bright, 30%) transparent;
  }
}
